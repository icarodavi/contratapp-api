---
description: 
globs: 
alwaysApply: true
---
# ğŸ“ PLANO DE DESENVOLVIMENTO â€” SISTEMA DE DISPUTA ELETRÃ”NICA DE LICITAÃ‡Ã•ES

Este documento apresenta o plano oficial de desenvolvimento do sistema de disputa eletrÃ´nica, parte integrante da plataforma de licitaÃ§Ãµes pÃºblicas conforme a **Lei nÂº 14.133/21**. Cada fase representa um estÃ¡gio modular do projeto, com tarefas especÃ­ficas, metas tÃ©cnicas e legais.

---

## âœ… FASE 0 â€“ PREPARAÃ‡ÃƒO

**Objetivo:** Definir estrutura base, escopo e tecnologias.

### Tarefas:
- [ ] Definir escopo do MVP (disputa eletrÃ´nica com chat, lances e documentos)
- [ ] Levantar exigÃªncias legais da Lei nÂº 14.133/21
- [ ] Mapear perfis de usuÃ¡rio: ADMIN, PREGOEIRO, LICITANTE, VISUALIZADOR
- [ ] Definir tecnologias:
  - Backend: NestJS + Prisma + PostgreSQL
  - Frontend: Next.js + Tailwind
  - Real-time: Socket.IO
- [ ] Criar repositÃ³rio Git e estrutura base do projeto
- [ ] Configurar ambiente com `.env.example` e scripts bÃ¡sicos

---

## ğŸ”§ FASE 1 â€“ MODELAGEM E BACK-END BASE

**Objetivo:** Criar estrutura de dados e primeiros serviÃ§os.

### Tarefas:
- [x] Modelar `schema.prisma` com:
  - Edital, Disputa, Licitante, Proposta, Lance
  - DocumentoLicitante, SessÃ£o, MensagemChat
  - DocumentoObrigatorio, LogAtividade, Usuario
- [x] Usar `Int` para valores monetÃ¡rios (centavos)
- [ ] Executar `prisma migrate dev`
- [ ] Criar serviÃ§os e controllers bÃ¡sicos para:
  - Editais
  - Disputas
  - Licitantes
  - Propostas

---

## ğŸ“ FASE 2 â€“ ENVIO DE DOCUMENTOS

**Objetivo:** Permitir protocolo de documentos por disputa.

### Tarefas:
- [ ] Criar endpoint de upload com Multer
- [ ] Armazenar arquivos no formato:
/uploads/{disputaId}/{licitanteId}/{tipoDocumento}/{versao}.pdf
- [ ] Validar tipo de documento com base na tabela `DocumentoObrigatorio`
- [ ] Armazenar metadados: nome original, descriÃ§Ã£o, versÃ£o, hash, assinatura
- [ ] Registrar envio no `LogAtividade`

---

## ğŸ’¬ FASE 3 â€“ CHAT EM TEMPO REAL

**Objetivo:** Permitir comunicaÃ§Ã£o aberta durante a disputa.

### Tarefas:
- [ ] Criar `ChatGateway` com eventos:
- `join_disputa`
- `send_message`
- `receive_message`
- [ ] Exibir mensagens com autor, horÃ¡rio e tipo
- [ ] Armazenar todas as mensagens no banco (`MensagemChat`)
- [ ] Restringir participaÃ§Ã£o com autenticaÃ§Ã£o (JWT)

---

## â³ FASE 4 â€“ CONTROLE DE TEMPO OFICIAL

**Objetivo:** Garantir cronÃ´metro sincronizado e auditÃ¡vel.

### Tarefas:
- [ ] Criar `TempoGateway` com eventos:
- `controlar_tempo`
- `atualizar_tempo`
- [ ] Controlar: INICIAR, PAUSAR, RETOMAR, ENCERRAR
- [ ] Sincronizar clientes com base em `tempoRestante` e `timestampServidor`
- [ ] Armazenar eventos no `LogAtividade`

---

## ğŸ¯ FASE 5 â€“ DISPUTA E LANCES

**Objetivo:** Implementar a fase de lances com regras da Lei 14.133/21.

### Tarefas:
- [ ] Criar painel com propostas iniciais
- [ ] Permitir envio de lances decrescentes
- [ ] Exibir classificaÃ§Ã£o em tempo real
- [ ] Implementar regra de empate ficto (ME/EPP)
- [ ] Armazenar lance com: valor em centavos, IP, user-agent, horÃ¡rio e `sessaoId`

---

## ğŸ§¾ FASE 6 â€“ RELATÃ“RIOS E VALIDAÃ‡ÃƒO PÃšBLICA

**Objetivo:** Emitir relatÃ³rios e permitir validaÃ§Ã£o de documentos.

### Tarefas:
- [ ] Gerar PDF da ata da disputa com QR Code
- [ ] Criar rota `/validar/:id` com hash e verificaÃ§Ã£o de assinatura
- [ ] Permitir download de documentos autenticados
- [ ] Registrar aÃ§Ãµes de validaÃ§Ã£o pÃºblica no `LogAtividade`

---

## ğŸ” FASE 7 â€“ SEGURANÃ‡A, PERFIS E PERMISSÃ•ES

**Objetivo:** Controlar aÃ§Ãµes por tipo de usuÃ¡rio e proteger o sistema.

### Tarefas:
- [ ] Implementar autenticaÃ§Ã£o com JWT
- [ ] Criar enum `PerfilUsuario` com:
- ADMIN, PREGOEIRO, LICITANTE, VISUALIZADOR
- [ ] Restringir acesso a funcionalidades sensÃ­veis via `@Roles`
- [ ] Proteger rotas com Guard e Interceptor
- [ ] Bloquear acesso a documentos de terceiros

---

## ğŸ§ª FASE 8 â€“ TESTES E AUDITORIA

**Objetivo:** Validar seguranÃ§a, integridade e conformidade do sistema.

### Tarefas:
- [ ] Criar testes unitÃ¡rios com Jest (serviÃ§os principais)
- [ ] Criar testes e2e simulando uma disputa completa
- [ ] Testar reconexÃµes WebSocket e tempo de disputa
- [ ] Validar juridicamente com procuradoria ou assessoria legal

---

## ğŸš€ FASE 9 â€“ DEPLOY, ENTREGA E TREINAMENTO

**Objetivo:** Colocar o sistema em produÃ§Ã£o com usuÃ¡rios reais.

### Tarefas:
- [ ] Preparar ambiente de produÃ§Ã£o (Docker, VPS, banco seguro)
- [ ] Realizar deploy e testes finais
- [ ] Criar documentaÃ§Ã£o de uso e treinamento para:
- Licitantes
- Pregoeiros
- Equipe de apoio tÃ©cnico
- [ ] Coletar feedback e planejar versÃ£o 2.0

---

## ğŸ“Œ BOAS PRÃTICAS TÃ‰CNICAS

- **Valores financeiros** devem ser armazenados como `Int` (em centavos)
- **Documentos** devem ser versionados e validados com hash
- **Eventos sensÃ­veis** devem ser registrados em `LogAtividade`
- **Toda comunicaÃ§Ã£o em tempo real** deve passar por autenticaÃ§Ã£o
- **Arquivos** devem seguir estrutura padronizada por disputa/licitante
- **PDFs gerados** devem conter QR Code com link de validaÃ§Ã£o pÃºblica

---

## ğŸ“š CONFORMIDADE COM A LEI 14.133/21

O sistema seguirÃ¡ os seguintes princÃ­pios da nova Lei de LicitaÃ§Ãµes:

- **Art. 5Âº** â€“ Legalidade, Impessoalidade, Moralidade, Igualdade, Publicidade, EficiÃªncia
- **Art. 17, Â§2Âº** â€“ Rastreabilidade das propostas e lances
- **Art. 60â€“66** â€“ Julgamento e fases da disputa
- **LC 123/2006, Art. 44â€“45** â€“ PreferÃªncia para ME/EPP (empate ficto)

---

**Este plano deve ser atualizado ao final de cada fase para refletir decisÃµes, adaptaÃ§Ãµes e ajustes tÃ©cnicos.**

**Desenvolvimento guiado por transparÃªncia, legalidade e seguranÃ§a.**